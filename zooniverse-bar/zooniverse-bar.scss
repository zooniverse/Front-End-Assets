$bg-color: transparentize(black, 0.4);
$fg-color: white;
$border-color: transparentize($fg-color, 0.8);

$bar-height: 30px;
$max-dropdown-height: 500px;
$max-accordion-height: 250px;

@mixin box-sizing($args) {
  -moz-box-sizing: $args;
  box-sizing: $args;
}

@mixin transition($args) {
  -moz-transition: $args;
  -webkit-transition: $args;
  transition: $args;
}

@mixin linear-gradient($start: transparent, $end: transparent, $from: top) {
  background-color: transparent;
  background-image: -moz-linear-gradient($from, $start, $end);
  background-image: -webkit-linear-gradient($from, $start, $end);
  background-image: linear-gradient($from, $start, $end);
}

// Menu bar
#zooniverse-bar {
  background: $bg-color;
  border-bottom: 1px solid $border-color;
  color: $fg-color;
  cursor: default;
  font: {
    family: Titillium, sans-serif;
    size: 12px;
  };
  height: $bar-height;
  letter-spacing: 1px;
  padding: 0 20px;
  position: relative;
  text-transform: uppercase;
  white-space: nowrap;
  z-index: 10;

  // *All* links descending from the bar
  a {
    color: inherit;
    text-decoration: none;
  }

  // Bar item group
  > ul {
    margin: 0;
    padding: 0;

    &.leading {
      float: left;

      > li {
        border-right: 1px solid $border-color;

        > div,
        > ul {
          left: 0;
          right: auto;
        }
      }
    }

    &.trailing {
      float: right;

      > li {
        border-left: 1px solid $border-color;

        > div,
        > ul {
          left: auto;
          margin: 0;
          padding: 0;
          right: 0;
        }
      }
    }

    // Bar item
    > li {
      display: inline-block;
      float: left;
      position: relative;

      &:hover {
        background: $bg-color;
      }

      // Bar item label
      > :first-child {
        display: inline-block;
        height: $bar-height;
        line-height: $bar-height + ($bar-height / 10);
        padding: 0 15px;
        text-decoration: none;

        // Menu or dropdown
        & + * {
          @include transition(#{
            max-height 0.25s ease-in-out,
            opacity 0.25s ease-in-out
          });
          background: $bg-color;
          border: 1px solid $border-color {
            radius: 0 0 5px 5px;
            top: 0;
          };
          font-size: 10px;
          line-height: normal;
          margin: 0;
          max-height: 0;
          opacity: 0;
          overflow: hidden;
          padding: 0;
          position: absolute;
          top: 100%;

          // Extra space for cursor overshoot
          &:after {
            content: " ";
            display: block;
            height: 100%;
            left: 0;
            margin: 0 0 0 -20px;
            padding: 0 20px 200px;
            position: absolute;
            top: 0;
            width: 100%;
            z-index: -1;
          }

          // Menu item
          > li {
            display: block;

            > a {
              border-top: 1px solid $border-color;
              display: block;
              padding: 5px 15px;
              white-space: nowrap;

              &:hover {
                background: $bg-color;
              }
            }

            // Accordion heading
            > label {
              border-top: 1px solid $border-color;
              cursor: pointer;
              display: block;
              font-size: 18px;
              padding: 10px 0;
              text-align: center;

              &:hover {
                background: $bg-color;
              }
            }

            // Accordion trigger
            > input[type="radio"],
            > input[type="checkbox"] {
              display: none;

              &:checked + ul {
                border-color: $border-color;
                max-height: $max-accordion-height;
              }
            }

            // Accordion menu
            > ul {
              @include transition(max-height 0.5s ease-in-out);
              margin: 0;
              max-height: 0;
              overflow: hidden;
              padding: 0;

              // Accordion menu item
              > li {
                display: block;

                > a {
                  border-top: 1px solid $border-color;
                  display: block;
                  padding: 5px 15px;
                  white-space: nowrap;

                  &:hover {
                    background: $bg-color;
                  }
                }

                &:last-child > a{
                  padding-bottom: 10px;
                }
              }
            }
          }

          &.sign-in {
            margin-top: 1px;
            padding: 5px 0;

            > form {
              > div {
                padding: 2px 15px;

                > label {
                  > span:first-child {
                    display: inline-block;
                    width: 80px;
                  }

                  > input {
                    @include box-sizing(border-box);
                    background: transparentize($fg-color, 0.8);
                    border: 1px solid transparentize($fg-color, 0.8);
                    box-shadow: 0 0 5px -1px $bg-color inset;
                    color: inherit;
                    font-family: inherit;
                    letter-spacing: inherit;
                    padding: 3px 5px;
                    width: 160px;
                  }
                }

                &.action {
                  text-align: right;

                  > a {
                    opacity: 0.8;
                    text-transform: none;
                  }

                  > button {
                    @include linear-gradient($border-color, transparent);
                    border: 1px solid $border-color;
                    color: inherit;
                    cursor: pointer;
                    font: {
                      family: inherit;
                      size: inherit;
                    };
                    letter-spacing: inherit;
                    margin-left: 10px;
                    padding: 5px 15px;
                    text-transform: inherit;
                  }
                }
              }
            }
          }
        }
      }

      // Menu or dropdown (with its item hovered)
      &:hover > :first-child + div,
      &:hover > :first-child + ul {
        max-height: $max-dropdown-height;
        opacity: 1;
        overflow: visible;
        z-index: 1;
      }
    }
  }
}
